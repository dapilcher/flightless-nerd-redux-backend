name: Deploy
on:
  workflow_run:
    workflows: ["Node.js CI"]
    types:
      - completed

jobs:
  deploy:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Deploy via rsync
        uses: burnett01/rsync-deployments@6.0.0
        with:
          switches: -avzr --delete --rsh "ssh"
          remote_path: ${{secrets.DEPLOY_PATH}}
          remote_host: ${{secrets.SSH_HOST}}
          remote_user: ${{secrets.SSH_USERNAME}}
          remote_key: ${{ secrets.SSH_KEY }}
      # - name: Deploy NodeJS app
      # uses: appleboy/ssh-action@v1.0.0
      # with:
      #   host: ${{secrets.SSH_HOST}} # IP address of the server you wish to ssh into
      #   key: ${{secrets.SSH_KEY}} # Private or public key of the server
      #   username: ${{secrets.SSH_USERNAME}} # User of the server you want to ssh into

      #   script: |
      #     mkdir test
      #     cd test
      #     git clone git@github.com:dapilcher/advanced-react-backend.git
      #     echo 'DigitalOcean deployment successful'
